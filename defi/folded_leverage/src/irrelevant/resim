resim call-function $package FoldedLeverage new
resim call-method $comp new_user $acc
resim call-method $comp new_lending_pool "1,$proof" "1000,$xrd"
resim call-method $comp new_lending_pool "1,$proof" "1000,$usd"
resim call-method $comp new_collateral_pool "1,$proof" "$xrd" "1000,$xrd"
resim call-method $comp deposit_supply "1,$proof" "$xrd" "1000,$xrd"
resim call-method $comp deposit_supply "1,$proof" "$usd" "1000,$usd"
resim call-method $comp deposit_collateral 1,$proof $xrd 1000,$xrd
resim call-method $comp convert_to_collateral 1,$proof $xrd 1000
resim call-method $comp convert_to_deposit 1,$proof $xrd 1000

resim call-method $comp create_transient_token --manifest ./transactions/create_token.rtm
resim call-method $comp borrow "1,$proof" "$xrd" 1000
resim call-method $comp repay 1,$proof $loan $xrd 1000,$xrd

resim call-method $comp redeem 1,$proof $xrd 1000

resim call-method $comp flash_borrow "1,$proof" "$xrd" 1000 "1,$flash" --manifest ./transactions/flash_borrow1.rtm
resim call-method $comp flash_repay "1,$proof" "$xrd" "1000,$xrd" "1,$flash" --manifest ./transactions/flash_repay1.rtm

resim call-method $lending set_address $collateral
resim call-method $collateral set_address $lending 
resim call-method $comp set_address $xrd $lending $collateral $user $comp

resim call-method $comp check_total_supplied $xrd
resim call-method $comp check_total_supplied $usd
resim call-method $comp check_total_collateral_supplied $xrd
resim call-method $comp check_total_borrowed $xrd
resim call-method $comp check_liquidity $xrd

resim call-method $comp get_sbt_info 1,$proof
resim call-method $comp get_loan_info $xrd $loan

resim call-method $comp set_price 1,$proof $xrd 0.5
resim call-method $comp find_bad_loans $xrd
resim call-method $comp liquidate $loan $xrd 1000,$xrd
resim call-method $comp credit_score_test 1,$proof 300

$xrd="030000000000000000000000000000000000000000000000000004"

/// If XRD price has been changed reflect on loan  

/// finish liquidation
/// Modify interest expense & collateralization based on credit score
/// Credit score for collateral?
/// Math for credit score can probably be abused
/// Change health factor and liquidation price when paying off loan
/// Change collateral amount of the loan NFT when liquidated
/// Test the ownersh % model